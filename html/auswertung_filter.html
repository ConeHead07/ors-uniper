{literal}
<style type="text/css">
    th.order {
        cursor:pointer;
    }
    #Auswertung.divInlay input[type=data] {
        background-color: #e2f2ff;
    }
</style>
{/literal}
{if $s eq "auswertung"}
    {assign var="showStatus" value=1}
{else}
    {assign var="showStatus" value=0}
{/if}
<div class="divModuleBasic padding6px width5Col heightAuto colorContentMain">
    <h1><span class="spanTitle">Auswertung beauftragter Aufträge</span></h1>

    <div id="Auswertung" class="divInlay">
        <form id="frmStat" name="frmStat" method="get" action="?">
            <div id="frmFilterBox" style="margin-bottom:1rem; border:1px solid #E0E0E0;padding:1rem;border-radius:8px;">
                <span style="border:0;font-weight:bold;">Zeitraum
                    <select id="auswertungDatumsfeld" name="datumfeld">
                        <option value="umzugstermin">Lieferdatum</option>
                        <option value="antragsdatum">Auftragsdatum</option>
                        <!-- option value="geprueft_am">Bestätigungsdatum</option -->
                        <option value="berechnet_am">Rechnungsdatum</option>
                    </select>
                    Von: <input type="date" name="datumvon" style="border-bottom:1px solid #E0E0E0;text-align:right;padding-right:5px" value="{$datumvon}" xonchange="document.forms['frmStat'].submit()">
                    Bis: <input type="date" name="datumbis" style="border-bottom:1px solid #E0E0E0;text-align:right;padding-right:5px"  value="{$datumbis}" xonchange="document.forms['frmStat'].submit()">
                {*
                    <select onchange="document.forms['frmStat'].submit()" selected="{$kwvon}" name="kwvon" style="border:0;font-weight:bold;font-size:12px;width:150px;background:none;">
                <option value="">auswählen</option>
                        {html_options options=$kw_options selected=$kwvon}
                </select> bis
                <select onchange="document.forms['frmStat'].submit()" selected="{$kwbis}" name="kwbis" style="border:0;font-weight:bold;font-size:12px;width:150px;">
                <option value="">auswählen</option>
                        {html_options options=$kw_options selected=$kwbis}
                </select>
                    *}
                <input type="hidden" name="s" value="{$s}">
                <input type="hidden" name="order" value="" id="orderby">
                <input type="hidden" name="queriedorder" value="{$order}">
                <input type="hidden" name="queriedodir" value="{$odir}">


                    <div style="margin-top:5px;margin-bottom:5px;">
                        <label style="margin-right:2rem"><input type="checkbox" name="auftragsstatus[]" id="filter_beauftragt" value="beauftragt"> Beauftragt</label>
                        <label style="margin-right:2rem"><input type="checkbox" name="auftragsstatus[]" id="filter_avisiert" value="avisiert"> Avisiert</label>
                        <label style="margin-right:2rem"><input type="checkbox" name="auftragsstatus[]" id="filter_abgeschlossen" value="abgeschlossen"> Abgeschlossen</label>
                        <label style="margin-right:2rem"><input type="checkbox" name="auftragsstatus[]" id="filter_abgerechnet" value="abgerechnet"> Abgerechnet</label>
                    </div>
                        <button type="submit" class="btn btn-apply">Auswertung starten</button>
                </span>
            </div>
            <script>
                var datumFilterFeld = "{$datumfeld}";
                var aAuftragsstatusFilter = {$aAuftragsstatus};
            </script>
            <script>{literal}
            $(function() {
                $("#auswertungDatumsfeld").val(datumFilterFeld);
                // $("#auswertungDatumsfeld").find("option[value=" + datumFilterFeld + "]").prop("selected", true);

                if (aAuftragsstatusFilter && Array.isArray(aAuftragsstatusFilter) && aAuftragsstatusFilter.length > 0) {
                    for(var ai = 0; ai < aAuftragsstatusFilter.length; ai++) {
                        var asel = '#filter_' + aAuftragsstatusFilter[ai];
                        $(asel).prop("checked", true);
                    }
                }

                var send = function() {
                    self.location.href = "?" + $("#frmStat").serialize();
                };

                $("th.order").click(function(e){
                    $("input#orderby").val( $(this).attr("data-fld") );
                    send();
                });

                $("th input").keypress(function(e){
                    if ( (e.keyCode || e.which) === 13) send();
                });

            });
            {/literal}
            </script>

            <div style="width:100%;overflow-x:scroll">
            <table class="tblList">
                <thead>
                <tr>
                    <th class="order" data-fld="aid" title="Auftrags-ID">ID</th>
                    <th class="order" data-fld="kid">KID</th>
                    <th class="order" data-fld="land" title="Land">L.</th>
                    <th class="order" data-fld="ort" data-fld="ort">Lieferort</th>
                    <th class="order" data-fld="plz">PLZ</th>
                    <th class="order" data-fld="strasse">Stra&szlig;e</th>
                    <th class="order" data-fld="service">Service</th>
                    <th class="order" data-fld="antragsdatum" title="Auftragsdatum">Auftr.Dat.</th>
                    <th class="order" data-fld="umzugstermin" title="Liefertermin">Lief.Dat.</th>
                    <th class="order" data-fld="abgeschlossen_am" title="Abgeschlossen am">Abschluss</th>
                    <th class="order" data-fld="berechnet_am" title="Berechnet am">RechDatum</th>
                    <th class="order" data-fld="vorgangsnummer" title="Rechnungsnummer">RechNr</th>
                    {if $showStatus}
                    <th class="order" data-fld="umzugsstatus" title="Auftragsstatus">Stat</th>
                    {/if}
                    <th class="order" data-fld="Leistungen abgekürzt" title="Leistungen abgekürzt">Lstg.</th>
                    <th class="order" data-fld="summe" title="Summe">Summe</th>
                </tr>
                <tr>
                    <th><input name="q[aid]" style="width:100%" value="{if !empty($q) && isset($q.aid)}{$q.aid}{/if}"></th>
                    <th><input name="q[kid]" style="width:100%" value="{if !empty($q) && isset($q.kid)}{$q.kid}{/if}"></th>
                    <th><input name="q[land]" style="width:100%" value="{if !empty($q) && isset($q.land)}{$q.land}{/if}"></th>
                    <th><input name="q[ort]" style="width:100%" value="{if !empty($q) && isset($q.ort)}{$q.ort}{/if}"></th>
                    <th><input name="q[plz]" style="width:100%" value="{if !empty($q) && isset($q.plz)}{$q.plz}{/if}"></th>
                    <th><input name="q[strasse]" style="width:100%" value="{if !empty($q) && isset($q.strasse)}{$q.strasse}{/if}"></th>
                    <th><input name="q[service]" style="width:100%" value="{if !empty($q) && isset($q.service)}{$q.service}{/if}"></th>
                    <th><input placeholder="JJJJ-MM-TT" name="q[antragsdatum]" style="width:100%" value="{if !empty($q) && isset($q.antragsdatum)}{$q.antragsdatum}{/if}"></th>
                    <th><input placeholder="JJJJ-MM-TT" name="q[umzugstermin]" style="width:100%" value="{if !empty($q) && isset($q.umzugstermin)}{$q.umzugstermin}{/if}"></th>
                    <th><input placeholder="JJJJ-MM-TT" name="q[abgeschlossen_am]" style="width:100%" value="{if !empty($q) && isset($q.abgeschlossen_am)}{$q.abgeschlossen_am}{/if}"></th>
                    <th><input placeholder="JJJJ-MM-TT" name="q[berechnet_am]" style="width:100%" value="{if !empty($q) && isset($q.berechnet_am)}{$q.berechnet_am}{/if}"></th>
                    <th><input name="q[vorgangsnummer]" style="width:100%" value="{if !empty($q) && isset($q.vorgangsnummer)}{$q.vorgangsnummer}{/if}"></th>
                    {if $showStatus}
                    <th><input name="q[umzugsstatus]" style="width:100%" value="{if !empty($q) && isset($q.umzugsstatus)}{$q.umzugsstatus}{/if}"></th>
                    {/if}
                    <th><input name="q[Leistungen]" style="width:100%" value="{if !empty($q) && isset($q.Leistungen)}{$q.Leistungen}{/if}"></th>
                    <th><input name="q[summe]" style="width:100%" value="{if !empty($q) && isset($q.summe)}{$q.summe}{/if}"></th>
                </tr>
                </thead>
                <tbody>
                {foreach name=AList item=item from=$Auftraege}
                <tr>
                    <td><a href="?s={$site_antrag}&id={$item.aid}">{$item.aid}</a></td>
                    <td>{$item.kid}</td>
                    <td>{if $item.land eq "Deutschland"}D{elseif $item.land eq "Niederlande"}NL{else}{$item.land|substr:0:3}{/if}</td>
                    <td>{$item.ort}</td>
                    <td>{$item.plz}</td>
                    <td>{$item.strasse}</td>
                    <td>{$item.service}</td>

                    <td title="{$item.antragsdatum|date_format:"%d.%m.%Y %H:%M"}">
                    {if !empty($item.antragsdatum) && {$item.antragsdatum|date_format:"%Y"} eq {'Y'|date}}
                    {$item.antragsdatum|date_format:"%d.%m."}
                    {else}
                    {$item.antragsdatum|date_format:"%d.%m.%y"}
                    {/if}
                    </td>

                    <td title="{$item.umzugstermin|date_format:"%d.%m.%Y"}">
                    {if !empty($item.umzugstermin) && {$item.umzugstermin|date_format:"%Y"} eq {'Y'|date}}
                    {$item.umzugstermin|date_format:"%d.%m."}
                    {else}
                    {$item.umzugstermin|date_format:"%d.%m.%y"}
                    {/if}
                    </td>

                    <td title="{$item.abgeschlossen_am|date_format:"%d.%m.%Y %H:%M"}">
                    {if !empty($item.abgeschlossen_am) && {$item.abgeschlossen_am|date_format:"%Y"} eq {'Y'|date}}
                    {$item.abgeschlossen_am|date_format:"%d.%m."}
                    {else}
                    {$item.abgeschlossen_am|date_format:"%d.%m.%y"}
                    {/if}
                    </td>


                    <td title="{$item.berechnet_am|date_format:"%d.%m.%Y %H:%M"}">
                    {if !empty($item.berechnet_am) && {$item.berechnet_am|date_format:"%Y"} eq {'Y'|date}}
                    {$item.berechnet_am|date_format:"%d.%m."}
                    {else}
                    {$item.berechnet_am|date_format:"%d.%m.%y"}
                    {/if}
                    </td>

                    <td>{$item.vorgangsnummer}</td>
                    {if $showStatus}
                    <td title="{$item.umzugsstatus|escape}">{$item.umzugsstatus|substr:0:5|escape}</td>
                    {/if}
                    <td title="{$item.LeistungenFull}">{$item.Leistungen}</td>
                    <td style="text-align:right;">{$item.summe|number_format:2:",":"."} &euro;</td>
                </tr>
                {/foreach}
                </tbody>
            </table>
            </div>
        </form>
    </div>
</div>
